---
name: xhs:generate-images
description: 为帖子生成配图 - 调用Qwen-Image API生成小红书风格图片
argument-hint: --post <帖子文件路径> [--style <风格>] [--count <数量>]
allowed-tools:
  - Read
  - Write
  - Bash
  - AskUserQuestion
---

# 生成配图命令

本命令为小红书帖子生成配图。

## 使用方式

```bash
# 默认生成3张图片
/xhs:generate-images --post "文案生成/小红书自媒体帖子/账号/帖子目录/content.md"

# 指定风格和数量
/xhs:generate-images --post "文案生成/..." --style "ins风" --count 5
```

参数：
- `--post`：帖子文件路径（必需）
- `--style`：图片风格（可选，如：ins风、中国风、卡通风、简约风）
- `--count`：生成图片数量（可选，默认3张，建议3-7张）

## 执行流程

### 第一步：读取帖子内容

1. 读取帖子文件
2. 分析主题和情感基调
3. 提取关键词和视觉元素

### 第二步：确定图片方案

#### 图片类型规划

| 类型 | 用途 | 数量 |
|------|------|------|
| 封面图 | 吸引点击 | 1张 |
| 内容图 | 展示内容 | 1-5张 |
| 细节图 | 补充说明 | 0-2张 |

#### 风格确认

根据内容类型推荐风格：

- **干货分享**：简洁专业、图文结合
- **生活记录**：温馨自然、真实感
- **种草推荐**：精致高级、明亮
- **知识科普**：信息可视化、清晰

### 第三步：生成提示词

为每张图片生成详细的提示词：

```
[主体描述] + [环境/背景] + [风格/氛围] + [技术细节]
```

示例：
```
现代化的办公桌面，电脑屏幕显示AI工具界面，
整洁有序的桌面布置，温暖明亮的灯光，
简洁专业的商务风格，高质量，4K分辨率
```

### 第四步：调用Qwen-Image API

#### API配置

```python
# API端点
url = "https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation"

# 请求参数
{
    "model": "qwen-image-plus",
    "input": {
        "messages": [{
            "role": "user",
            "content": [{"text": "提示词"}]
        }]
    },
    "parameters": {
        "size": "1328*1328",  # 小红书推荐1:1比例
        "watermark": False,
        "prompt_extend": True
    }
}
```

#### 调用脚本

```bash
python3 $CLAUDE_PLUGIN_ROOT/scripts/generate_image.py \
  --prompt "提示词" \
  --output "/path/to/downloads/image_01.jpg"
```

**重要**：脚本路径使用 `$CLAUDE_PLUGIN_ROOT` 环境变量，确保在全局安装时也能正确找到脚本。

### 第五步：下载和保存

1. 获取生成的图片URL
2. 下载图片到本地
3. 按序命名保存到 `downloads/` 目录
4. 记录图片元数据

### 第六步：图片后处理（预留）

预留功能（当前为占位符）：

- 尺寸调整
- 水印添加
- 文字叠加
- 质量优化

## 输出格式

```markdown
# 配图生成报告

## 帖子信息
- 文件：[路径]
- 主题：[主题]
- 生成时间：[时间]

## 生成方案
- 总数量：[数量]张
- 风格：[风格]
- 尺寸：1328*1328 (1:1)

## 生成详情

### 封面图 (image_01.jpg)
**提示词**：[完整提示词]
**设计意图**：[说明]
**状态**：✅ 成功 / ❌ 失败

### 内容图1 (image_02.jpg)
**提示词**：[完整提示词]
**设计意图**：[说明]
**状态**：✅ 成功 / ❌ 失败

[继续...]

## 生成结果

| 图片 | 状态 | URL | 说明 |
|------|------|-----|------|
| image_01.jpg | ✅ | [URL] | 封面图 |
| image_02.jpg | ✅ | [URL] | 内容展示 |
| image_03.jpg | ❌ | - | API超时，已重试 |

**成功**：[数量]张
**失败**：[数量]张

## 文件位置
图片已保存到：`[帖子目录]/downloads/`

## 后续步骤
1. 检查图片质量和风格一致性
2. 确认图片符合帖子主题
3. 使用 `/xhs:publish` 发布到平台
```

## 风格选项

### 常见风格

| 风格 | 特点 | 适用场景 |
|------|------|---------|
| ins风 | 简洁、明亮、高级 | 生活方式、时尚 |
| 中国风 | 传统、优雅、文化 | 文化内容、节日 |
| 卡通 | 可爱、活泼、色彩鲜明 | 轻松内容、教育 |
| 简约 | 干净、清爽、有条理 | 干货分享、职场 |
| 手绘 | 温暖、亲切、有温度 | 情感内容、故事 |
| 商务 | 专业、正式、有质感 | 职场、商业 |

### 色调选项

- 温暖色调：温馨、亲切
- 冷色调：专业、冷静
- 明亮色调：活力、积极
- 柔和色调：温和、舒适
- 莫兰迪色：高级、雅致

## 环境变量要求

需要配置以下环境变量：

```bash
# Qwen-Image API Key（必需）
export DASHSCOPE_API_KEY="sk-xxxxxxxx"

# API端点（可选，默认北京）
export DASHSCOPE_API_URL="https://dashscope.aliyuncs.com/api/v1"
```

## 注意事项

1. **API限制**
   - RPS限制：2请求/秒
   - 并发控制：避免同时请求过多

2. **成本控制**
   - 价格：0.2元/张
   - 建议先生成1张测试

3. **URL有效期**
   - 图片链接24小时有效
   - 及时下载保存

4. **质量检查**
   - 生成后检查图片质量
   - 不满意可重新生成

5. **风格一致性**
   - 同组图片保持风格统一
   - 符合小红书审美

## 错误处理

### API认证失败

```
❌ API认证失败

请检查环境变量：
export DASHSCOPE_API_KEY="your-key"

获取API Key：https://help.aliyun.com/zh/model-studio/get-api-key
```

### API调用超时

```
⚠️ API调用超时

正在重试... (1/3)
正在重试... (2/3)
```

### 内容违规

```
❌ 生成失败：内容违规

提示词可能包含敏感内容，建议：
1. 修改提示词
2. 移除敏感词汇
3. 尝试其他表达方式
```

### 下载失败

```
⚠️ 图片下载失败

图片URL已保存，请手动下载：
[URL]

注意：URL有效期24小时
```

## 成本估算

| 数量 | 成本 |
|------|------|
| 1张 | 0.2元 |
| 3张 | 0.6元 |
| 5张 | 1.0元 |
| 7张 | 1.4元 |

建议：
- 测试阶段：生成1-3张
- 正式发布：生成3-7张

## 下一步

图片生成完成后：
1. 检查图片质量和风格
2. 确认符合帖子主题
3. 使用 `/xhs:publish` 发布
4. 或继续编辑调整
