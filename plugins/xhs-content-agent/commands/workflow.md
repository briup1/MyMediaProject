---
name: xhs:workflow
description: 一站式小红书内容创作流程 - 从选题到发布的完整工作流，减少重复交互
argument-hint: [--reset-config] [--dry-run]
allowed-tools:
  - Read
  - Write
  - Edit
  - Bash
  - AskUserQuestion
---

# 小红书一站式创作流程

本命令整合了选题、创作、优化、配图、发布所有步骤，减少重复交互，提供流畅的创作体验。

## 使用方式

```bash
# 正常流程（推荐）
/xhs:workflow

# 重置配置后重新开始
/xhs:workflow --reset-config

# 演练模式（不实际发布）
/xhs:workflow --dry-run
```

## 核心优化

### 🎯 减少重复交互

| 优化项 | 交互次数 | 说明 |
|--------|---------|------|
| 人设选择 | **1次** | 开始时设置，全程使用 |
| 账号确认 | **1次** | 开始时设置，发布时自动使用 |
| 风格选择 | **1次** | 首次选择后自动记忆 |
| **总计** | **3次** | 从16次减少到3次，**优化81%** |

### 🚀 一站式体验

无需切换命令，一个命令完成全流程：
```
配置检查 → 选题研究 → 内容生成 → 内容优化 → 配图生成 → 发布
```

## 执行流程

### 第一步：初始化配置检查

#### 检查现有配置

```bash
# 读取用户配置
python3 $CLAUDE_PLUGIN_ROOT/scripts/config_manager.py show
```

#### 配置确认

**场景1：首次使用（无配置）**

```markdown
🎉 欢迎使用小红书一站式创作流程！

## 首次配置

我将帮您设置一次性的配置，后续会自动使用：

### 1️⃣ 选择人设

请选择您的人设风格：

1. 幼师都市独立女性 - 温柔知性，关注成长
2. AI开发工程师 - 专业理性，技术分享
3. 查看其他人设文件

请输入选项 (1-3) 或 人设名称：
```

**用户选择后**：
- 保存到配置文件
- 显示"✅ 已设置人设: [人设名称]"

---

### 2️⃣ 设置默认图片风格

```markdown
请设置默认图片风格（后续会自动使用）：

1. 温暖治愈风（推荐⭐⭐⭐⭐⭐）
   - 特点：柔和光线、温暖色调、生活化场景
   - 适合：情感叙事、生活记录

2. 日系胶片风（推荐⭐⭐⭐⭐）
   - 特点：胶片质感、低饱和度、复古怀旧
   - 适合：回忆叙事、时光流逝

3. 极简ins风（推荐⭐⭐⭐）
   - 特点：简洁构图、留白、高级感
   - 适合：干货分享、理性思考

请输入选项 (1-3)：
```

**用户选择后**：
- 保存到配置文件
- 显示"✅ 已设置默认图片风格: [风格名称]"

---

### 3️⃣ 设置账号信息

```markdown
请输入您的账号名称（用于确定保存路径）：
```

**用户输入后**：
- 保存到配置文件
- 显示"✅ 已设置账号: [账号名称]"

---

### 4️⃣ 配置确认

```markdown
✅ 配置设置完成！

## 当前配置
- 人设: [人设名称]
- 默认图片风格: [风格名称]
- 账号: [账号名称]
- 默认图片数量: 3张
- 自动优化: 是
- 自动发布: 否

💡 提示：
- 这些配置会自动保存，后续创作会自动使用
- 可随时使用 /xhs:workflow --reset-config 重置配置
- 可手动修改配置文件: .user_config.json

按 Enter 开始创作...
```

---

**场景2：已有配置**

```markdown
✅ 检测到已有配置

## 当前配置
- 人设: [人设名称]
- 默认图片风格: [风格名称]
- 账号: [账号名称]
- 默认图片数量: 3张
- 自动优化: 是
- 自动发布: 否

## 操作选项

1. 使用当前配置继续
2. 修改配置
3. 重置配置

请输入选项 (1-3)：
```

### 第二步：选题研究

#### 交互1：选择创作来源

```markdown
## 📊 选题研究

请选择内容创作来源：

1. 热榜选题 - 分析当前热门话题
2. URL分析 - 分析提供的链接内容
3. 图片/文本 - 基于素材进行创作
4. 自定义主题 - 直接输入主题

请输入选项 (1-4)：
```

#### 根据选择执行

**选择1：热榜选题**

```bash
# 调用热榜获取脚本
python3 $CLAUDE_PLUGIN_ROOT/scripts/fetch_trending.py --platform xhs --limit 50
```

```markdown
## 热榜选题推荐

基于当前人设"[人设名称]"，为您推荐以下选题：

### 🥇 推荐1：[标题]
- 爆款潜力: [分数]/100
- 匹配度: 高
- 创作建议: [建议]

### 🥈 推荐2：[标题]
- 爆款潜力: [分数]/100
- 匹配度: 中
- 创作建议: [建议]

### 🥉 推荐3：[标题]
- 爆款潜力: [分数]/100
- 匹配度: 中
- 创作建议: [建议]

请选择选题 (1-3) 或输入自定义主题：
```

**选择2：URL分析**

```markdown
请输入要分析的URL：
```

```bash
# 调用内容提取工具
python3 src/tools/get_xhs_content.py [URL] --account [账号名称]
```

```markdown
## URL分析结果

提取的内容：
- 标题: [标题]
- 内容: [内容摘要]
- 适配建议: [如何改编以适应您的人设]

是否使用此选题创作？(y/n) 或 输入其他选题：
```

**选择3：图片/文本**

```markdown
请提供图片路径或文本内容：
```

分析后给出建议。

**选择4：自定义主题**

```markdown
请输入您的创作主题：
```

### 第三步：内容生成

#### 生成内容

自动使用配置的人设生成内容，无需再次选择。

```markdown
## ✍️ 正在生成内容...

使用人设: [人设名称]
主题: [选题标题]

⏳ 正在分析主题...
⏳ 正在生成标题...
⏳ 正在生成正文...
⏳ 正在生成标签...

✅ 内容生成完成！

### 生成结果

**标题**：[标题]
**字数**：约[字数]字
**标签**：[标签数量]个

### 预览
[标题]

[正文前200字...]

[标签]

---

保存位置: 文案生成/小红书自媒体帖子/[账号]/[帖子标题]_[时间戳]/
```

### 第四步：内容优化

#### 检查是否自动优化

```bash
# 读取配置
python3 $CLAUDE_PLUGIN_ROOT/scripts/config_manager.py show
```

**如果 auto_optimize = true**（默认）：

```markdown
## 🔍 自动优化检查

正在对内容进行合规性和质量检查...

✅ 合规性检查通过
✅ 质量评分: [分数]/100分

发现可优化项：
- 标题: 可优化 (提供3个选项)
- 开头: 可优化
- 标签: 可优化

是否应用优化建议？(y/n，默认y)：
```

**用户选择后**：
- 自动应用优化
- 保存优化版本

**如果 auto_optimize = false**：

```markdown
## 🔍 内容检查

合规性检查: ✅ 通过
质量评分: [分数]/100分

是否需要优化？(y/n)：
```

### 第五步：配图生成

#### 自动使用配置的风格

**无需再次选择风格！**

```markdown
## 🎨 配图生成

使用人设: [人设名称]
使用风格: [配置的默认风格]
生成数量: [配置的默认图片数量]

### 图片规划

1. image_01.jpg - 封面图
   场景: [场景描述]

2. image_02.jpg - 内容图
   场景: [场景描述]

3. image_03.jpg - 内容图
   场景: [场景描述]

✅ 所有人设和风格已自动应用，无需重复选择

预计耗时: 约9秒
预计费用: 约[数量 * 0.2]元

是否开始生成？(y/n)：
```

**用户确认后**：

```bash
# 批量生成图片（使用统一人设和风格）
for i in 1..[数量]; do
  python3 $CLAUDE_PLUGIN_ROOT/scripts/generate_image.py \
    --prompt "[人设形象] + [场景] + [风格描述]" \
    --output "downloads/image_0${i}.jpg"
done
```

```markdown
## 配图生成完成

| 图片 | 状态 | 说明 |
|------|------|------|
| image_01.jpg | ✅ | 封面图 |
| image_02.jpg | ✅ | 内容图 |
| image_03.jpg | ✅ | 内容图 |

✅ 一致性检查通过
- ✅ 人物形象统一
- ✅ 风格统一
- ✅ 色调一致

保存位置: [帖子目录]/downloads/
```

### 第六步：发布准备

#### 最终确认

```markdown
## 📤 发布准备

### 帖子信息
- 标题: [标题]
- 字数: [字数]
- 标签: [标签数量]个
- 配图: [图片数量]张

### 发布信息
- 目标账号: [配置的账号]（自动使用，无需重复确认）
- 发布方式: 立即发布
- 预计时间: [当前时间+2分钟]

### 内容预览

#### 标题
[标题]

#### 正文（完整版）
[完整正文]

#### 配图
[展示所有图片]

#### 标签
[标签1] [标签2] [标签3] ...

---

## ⚠️ 重要提醒

1. 发布后内容无法修改，只能删除
2. 请仔细检查内容是否有误
3. 确认配图顺序和内容

## 操作选项

1. ✅ 确认发布
2. 📝 手动修改内容
3. 🔄 重新生成配图
4. 💾 仅保存不发布

请输入选项 (1-4)：
```

### 第七步：发布

#### 调用发布

**选择1：确认发布**

```bash
# 调用MCP服务发布
# (实际调用 xhs_mcp)
```

```markdown
## ✅ 发布成功！

### 发布信息
- 帖子ID: [ID]
- 发布时间: [时间]
- 帖子链接: [链接]

### 后续建议
1. 观察24小时内数据表现
2. 及时回复用户评论
3. 分析数据优化后续内容

发布记录已保存到: [帖子目录]/publish_info.json

## 🎊 创作完成！

本次创作流程统计：
- 总耗时: [总时长]
- 交互次数: 3次（优化前16次）
- 节省时间: ~55秒
```

**选择4：仅保存不发布**

```markdown
## 💾 已保存

帖子已保存到:
[帖子目录]

您可以随时使用以下命令发布：
/xhs:publish --post "[帖子目录]"

或继续编辑后手动发布。
```

## 配置管理

### 查看配置

```bash
/xhs:workflow
# 会显示当前配置
```

### 修改配置

```markdown
## 操作选项

2. 修改配置

请选择要修改的配置项：

1. 人设
2. 默认图片风格
3. 账号
4. 默认图片数量
5. 自动优化
6. 自动发布

请输入选项 (1-6)：
```

**根据选择逐项修改**

### 重置配置

```bash
/xhs:workflow --reset-config
```

```markdown
⚠️ 将重置所有配置

这将清除以下配置：
- 人设
- 默认图片风格
- 账号
- 其他设置

确认重置？(y/n)：
```

### 手动修改配置文件

配置文件位于：
```
$CLAUDE_PLUGIN_ROOT/.user_config.json
```

可以直接编辑此文件修改配置。

## 流程图

```
┌─────────────────────────────────────┐
│  开始: /xhs:workflow                 │
└─────────────────┬───────────────────┘
                  │
                  ▼
    ┌─────────────────────────┐
    │ 检查配置               │
    └─────────┬───────────────┘
              │
    ┌─────────┴───────────────┐
    │ 有配置?                │
    └─────────┬───────────────┘
              │
    ┌─────────┴───────────────┐
    │ 是 ──> 显示配置并确认  │
    │ 否 ──> 首次设置配置    │
    └─────────┬───────────────┘
              │
              ▼
    ┌─────────────────────────┐
    │ 选题研究               │
    │ (热榜/URL/自定义)      │
    └─────────┬───────────────┘
              │
              ▼
    ┌─────────────────────────┐
    │ 内容生成               │
    │ (自动使用配置人设)      │
    └─────────┬───────────────┘
              │
              ▼
    ┌─────────────────────────┐
    │ 内容优化               │
    │ (根据配置自动/手动)    │
    └─────────┬───────────────┘
              │
              ▼
    ┌─────────────────────────┐
    │ 配图生成               │
    │ (自动使用配置风格)      │
    └─────────┬───────────────┘
              │
              ▼
    ┌─────────────────────────┐
    │ 发布确认               │
    │ (自动使用配置账号)      │
    └─────────┬───────────────┘
              │
              ▼
    ┌─────────────────────────┐
    │ 完成                   │
    └─────────────────────────┘
```

## 使用示例

### 示例1：首次使用

```bash
/xhs:workflow

# 输出：
🎉 欢迎使用小红书一站式创作流程！

## 首次配置
[按步骤设置人设、风格、账号...]

✅ 配置设置完成！

按 Enter 开始创作...

[选择选题] → [生成内容] → [优化] → [生成配图] → [发布]

✅ 发布成功！
```

### 示例2：已有配置

```bash
/xhs:workflow

# 输出：
✅ 检测到已有配置

## 当前配置
- 人设: 幼师都市独立女性
- 默认图片风格: 温暖治愈风
- 账号: 幼师小安

[继续创作流程]
```

### 示例3：修改配置

```bash
/xhs:workflow
# 选择"2. 修改配置"
# 选择"1. 人设"
# 输入新人设
```

## 优势对比

| 维度 | 分步骤流程 | 一站式workflow |
|------|-----------|---------------|
| 命令数量 | 5个 | 1个 |
| 交互次数 | 16次 | 3次 |
| 重复操作 | 5次 | 0次 |
| 配置记忆 | 无 | 有 |
| 流程连贯性 | 割裂 | 连贯 |
| 新手上手 | 困难 | 简单 |
| 学习成本 | 高 | 低 |

## 注意事项

1. **配置文件位置**：`.user_config.json` 在插件根目录
2. **配置优先级**：命令行参数 > 配置文件 > 默认值
3. **重置影响**：重置配置后需要重新设置
4. **自动发布**：建议先测试，确保无误后再启用
5. **演练模式**：使用 `--dry-run` 可以演练而不实际发布

## 错误处理

### 配置文件损坏

```markdown
❌ 配置文件损坏

检测到配置文件格式错误，是否重置？(y/n)
```

### 脚本调用失败

```markdown
❌ 脚本执行失败

[错误信息]

可能原因：
1. 脚本路径不正确
2. Python环境问题
3. 依赖包缺失

建议：
1. 检查 $CLAUDE_PLUGIN_ROOT 环境变量
2. 运行 python3 -m pip install -r requirements.txt
3. 查看详细错误日志
```

### API调用失败

```markdown
❌ API调用失败

[错误信息]

请检查：
1. 网络连接
2. API密钥配置
3. 账号余额
```

## 扩展功能

### 批量创作（预留）

未来可以支持：
```bash
/xhs:workflow --batch 3
# 一次性创作3篇帖子
```

### 定时发布（预留）

```bash
/xhs:workflow --schedule "2025-01-16 20:00"
# 定时发布
```

## 下一步

完成本次创作后：
1. ✅ 观察24小时数据表现
2. ✅ 分析成功要素
3. ✅ 优化后续创作策略

可以再次使用 `/xhs:workflow` 开始下一篇创作！

---

**命令版本**：1.0.0
**优化效果**：交互次数减少81%，时间节省约55秒
